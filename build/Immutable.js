(function(){"use strict";function t(t){return Object(t)===t}function r(r){if(t(r)){var n=Object.getPrototypeOf(r);return null===n||n===Object.prototype}return!1}function n(t,r){return Array(r+1).join(t)}function e(t,r,e){var o=Math.max(0,r-t.length);return t+n(e,o)}function o(t,r){if(t.length){var n="\n"+r;return n+t.map(function(t){return t.replace(/\n/g,n)}).join(n)}return""}function i(t){var r=typeof t;if("string"===r)return'"'+t.replace(/\\/g,"\\\\").replace(/\"/g,'\\"').replace(/\n/g,"\n ")+'"';if("number"===r||"boolean"===r||"undefined"===r||null===t)return""+t;var n=t[_r];if(null!=n)return n(t);var e="(Mutable "+ ++Sr+")";return Object.defineProperty(t,_r,{configurable:!1,enumerable:!1,writable:!1,value:function(){return e}}),e}function u(t,r){var u=[],f=0;t.forEach(function(t){var r=i(t[0]),n=i(t[1]);r=r.split(/\n/),r.forEach(function(t){f=Math.max(f,t.length)}),u.push({key:r,value:n})});var r="  ";return u=u.map(function(t){var r=t.key.length-1;t.key[r]=e(t.key[r],f," ");var o=t.key.join("\n"),i=t.value.replace(/\n/g,"\n"+n(" ",f+3));return o+" = "+i}),o(u,r)}function f(r){if(t(r)){var n=r[zr];return null!=n?n(r):r}return r}function h(t){var r={};return t.forEach(function(t){var n=t[0],e=t[1];if("string"!=typeof n)throw Error("Cannot convert to JavaScript: expected string key but got "+n);r[n]=f(e)}),r}function s(t){var r=[];return t.forEach(function(t){r.push(f(t))}),r}function a(r){if(t(r)){var n=r[Ar];if(null!=n){var e=br[n];if(null!=e)return e(r);throw Error("Cannot handle type "+n)}return r}return r}function c(r){if(t(r)){var n=r[xr];return null!=n?n(r):r}return r}function p(t,r){var n={};return n[Ar]=t,n.keys=[],n.values=[],r.forEach(function(t){var r=t[0],e=t[1];n.keys.push(c(r)),n.values.push(c(e))}),n}function l(t,r){var n={};return n[Ar]=t,n.values=[],r.forEach(function(t){n.values.push(c(t))}),n}function y(t){for(var r=t.keys,n=t.values,e=r.length,o=Array(e),i=0;e>i;++i)o[i]=[a(r[i]),a(n[i])];return o}function v(t){for(var r=t.values,n=r.length,e=Array(n),o=0;n>o;++o)e[o]=a(r[o]);return e}function g(t,r){return t>r?t:r}function E(t,r,n){var e=r.depth,o=n.depth;if(e>o+1){var i=r.left,u=r.right;return u.depth>i.depth?u.copy(r.copy(i,u.left),t.copy(u.right,n)):r.copy(i,t.copy(u,n))}if(o>e+1){var f=n.right,h=n.left;return h.depth>f.depth?h.copy(t.copy(r,h.left),n.copy(h.right,f)):n.copy(t.copy(r,h),f)}return t.copy(r,n)}function d(t,r){if(t===Or)return r;if(r===Or)return t;if(t.depth<r.depth){var n=d(t,r.left);return E(r,n,r.right)}var e=d(t.right,r);return E(t,t.left,e)}function w(t,r){return t===Or?r:E(t,w(t.left,r),t.right)}function m(t,r){return t===Or?r:E(t,t.left,m(t.right,r))}function k(t,r){return t===r?0:r>t?-1:1}function _(t,r){return t=i(t),r=i(r),k(t,r)}function S(t,r,n){for(;t!==Or;){var e=r(n,t.key);if(0===e)break;t=0>e?t.left:t.right}return t}function z(t,r,n,e){if(t===Or)return e;var o=t.left,i=t.right,u=r(n,t.key);if(0===u)return t.modify(e);if(0>u){var f=z(o,r,n,e);return f===o?t:E(t,f,i)}var f=z(i,r,n,e);return f===i?t:E(t,o,f)}function b(t,r,n,e){if(t===Or)throw Error("Key "+n+" not found");var o=t.left,i=t.right,u=r(n,t.key);if(0===u)return t.modify({key:n,value:e(t.value)});if(0>u){var f=b(o,r,n,e);return f===o?t:E(t,f,i)}var f=b(i,r,n,e);return f===i?t:E(t,o,f)}function A(t,r,n){if(t===Or)return t;var e=t.left,o=t.right,i=r(n,t.key);if(0===i)return d(e,o);if(0>i){var u=A(e,r,n);return u===e?t:E(t,u,o)}var u=A(o,r,n);return u===o?t:E(t,e,u)}function x(t,r,n,e){this.left=t,this.right=r,this.key=n,this.value=e,this.depth=g(t.depth,r.depth)+1}function O(t,r){this.root=t,this.sort=r,this.hash=null}function j(t){return t instanceof O}function D(t){return j(t)&&t.sort!==_}function C(t,n){if(null!=n){if(n instanceof O&&n.sort===t)return n;var e=new O(Or,t);return r(n)?Object.keys(n).forEach(function(t){e=e.set(t,n[t])}):n.forEach(function(t){var r=t[0],n=t[1];e=e.set(r,n)}),e}return new O(Or,t)}function R(t){return C(_,t)}function I(t,r,n){this.left=t,this.right=r,this.key=n,this.depth=g(t.depth,r.depth)+1}function J(t,r){this.root=t,this.sort=r,this.hash=null}function B(t){return t instanceof J}function L(t){return B(t)&&t.sort!==_}function M(t,r){if(null!=r){if(r instanceof J&&r.sort===t)return r;var n=new J(Or,t);return r.forEach(function(t){n=n.add(t)}),n}return new J(Or,t)}function N(t){return M(_,t)}function Q(t){for(var r=t.length,n=Array(r),e=0;r>e;++e)n[e]=t[e];return n}function F(t,r,n){for(var e=t.length+1,o=Array(e),i=0;r>i;)o[i]=t[i],++i;for(o[i]=n,++i;e>i;)o[i]=t[i-1],++i;return o}function K(t,r,n){var e=t[r],o=n(e);if(e===o)return t;var i=Q(t);return i[r]=o,i}function q(t,r){for(var n=t.length-1,e=Array(n),o=0;r>o;)e[o]=t[o],++o;for(;n>o;)e[o]=t[o+1],++o;return e}function P(t,r){this.car=t,this.cdr=r}function G(t,r){if(t.length){var n=t[t.length-1];n.length+r.length<=Dr?t[t.length-1]=n.concat(r):t.push(r)}else t.push(r)}function H(t,r,n){if(n>r){var e=Rr((r+n)/2),o=H(t,r,e),i=H(t,e+1,n);return new X(o,i,t[e])}return Or}function T(t){return H(t,0,t.length)}function U(t,r,n){0>r&&(r=0);var e=t.length;return n>e&&(n=e),0===r&&n===e?t:t.slice(r,n)}function V(t,r){for(var n=Array(r);r--;)n[r]=t.car,t=t.cdr;return n}function W(t,r,n){for(;--r!==n;)t=t.cdr;return t.car}function X(t,r,n){this.left=t,this.right=r,this.array=n,this.size=t.size+r.size+n.length,this.depth=g(t.depth,r.depth)+1}function Y(t,r){return t>=0&&r>t}function Z(t,r){for(;;){var n=t.left,e=n.size;if(e>r)t=n;else{r-=e;var o=t.array,i=o.length;if(i>r)return o[r];r-=i,t=t.right}}}function $(t,r,n){if(t===Or)return new X(Or,Or,[n]);var e=t.left,o=t.right,i=e.size;if(i>r){var u=$(e,r,n);return E(t,u,o)}r-=i;var f=t.array,h=f.length;if(h>=r){if(f=F(f,r,n),h===Dr){var s=Cr(f.length/2),a=f.slice(0,s),c=f.slice(s);return e.depth<o.depth?new X(m(e,new X(Or,Or,a)),o,c):new X(e,w(o,new X(Or,Or,c)),a)}return new X(e,o,f)}var u=$(o,r-h,n);return E(t,e,u)}function tr(t,r,n){var e=t.left,o=t.right,i=e.size;if(i>r){var u=tr(e,r,n);return u===e?t:t.copy(u,o)}r-=i;var f=t.array,h=f.length;if(h>r){var s=K(f,r,n);return s===f?t:new X(e,o,s)}var u=tr(o,r-h,n);return u===o?t:t.copy(e,u)}function rr(t,r){var n=t.left,e=t.right,o=n.size;if(o>r){var i=rr(n,r);return E(t,i,e)}r-=o;var u=t.array,f=u.length;if(f>r)return u=q(u,r),0===u.length?d(n,e):new X(n,e,u);var i=rr(e,r-f);return E(t,n,i)}function nr(t,r,n,e){if(r!==Or){var o=r.left,i=o.size;i>n&&nr(t,o,n,e);var u=r.array,f=u.length;n-=i,e-=i,f>n&&e>0&&G(t,U(u,n,e)),e>f&&nr(t,r.right,n-f,e-f)}}function er(t,r,n){this.root=t,this.tail=r,this.tail_size=n,this.hash=null}function or(t){return t instanceof er}function ir(t){if(null!=t){if(t instanceof er)return t;var r=new er(Or,Or,0);return t.forEach(function(t){r=r.insert(t)}),r}return new er(Or,Or,0)}function ur(t,r,n){this.left=t,this.right=r,this.len=n,this.hash=null}function fr(t){return t instanceof ur}function hr(t){if(null!=t){if(t instanceof ur)return t;var r=new ur(Or,Or,0);return t.forEach(function(t){r=r.push(t)}),r}return new ur(Or,Or,0)}function sr(t,r){this.root=t,this.len=r,this.hash=null}function ar(t){return t instanceof sr}function cr(t){if(null!=t){if(t instanceof sr)return t;var r=new sr(Or,0);return t.forEach(function(t){r=r.push(t)}),r}return new sr(Or,0)}function pr(t,r){this.keys=t,this.values=r,this.hash=null}function lr(t){return t instanceof pr}function yr(t){var n={},e=[];if(null!=t){if(t instanceof pr)return t;r(t)?Object.keys(t).forEach(function(r){if("string"!=typeof r)throw Error("Expected string key but got "+r);n[r]=e.push(t[r])-1}):t.forEach(function(t){var r=t[0],o=t[1];if("string"!=typeof r)throw Error("Expected string key but got "+r);n[r]=e.push(o)-1})}return new pr(n,e)}function vr(t,r){this._id=++Ir,this._value=t,this._onchange=r}function gr(t){return Er(t)?t.get():t}function Er(t){return t instanceof vr}function dr(t,r){if(arguments.length<1||arguments.length>2)throw Error("Expected 1 to 2 arguments but got "+arguments.length);return new vr(t,r)}function wr(t,r){return t===r||i(t)===i(r)}function mr(t){return j(t)||B(t)||or(t)||fr(t)||ar(t)||lr(t)}function kr(t){if(Array.isArray(t)){for(var n=ir(),e=0,o=t.length;o>e;++e)n=n.insert(kr(t[e]));return n}if(r(t)){var n=R();for(var i in t)n=n.set(i,kr(t[i]));return n}return t}var _r="__CFB38D33-7CD8-419E-A1B6-61D1B8AC7C83_hash__",Sr=0,zr="__DEE5921D-20A6-40D0-9A74-40C5BAC8C663_toJS__",br={},Ar="__B81911B5-071E-431E-B82E-AA7ADFEA301F_type__",xr="__836134D4-35C1-46C4-971D-1522F0A1E75A_toJSON__",Or={};Or.depth=0,Or.size=0,Or.forEach=function(){},Or.forEachRev=function(){};var jr={};jr.toString=function(){return i(this)},jr.inspect=jr.toString,x.prototype.copy=function(t,r){return new x(t,r,this.key,this.value)},x.prototype.modify=function(t){var r=t.key,n=t.value;return this.key===r&&this.value===n?this:new x(this.left,this.right,r,n)},x.prototype.forEach=function(t){this.left.forEach(t),t([this.key,this.value]),this.right.forEach(t)},O.prototype=Object.create(jr),O.prototype[_r]=function(t){return null===t.hash&&(t.hash=t.sort===_?"(Dict"+u(t,"  ")+")":"(SortedDict "+i(t.sort)+u(t,"  ")+")"),t.hash},br.Dict=function(t){return R(y(t))},O.prototype[xr]=function(t){if(t.sort===_)return p("Dict",t);throw Error("Cannot convert SortedDict to JSON")},O.prototype[zr]=h,O.prototype.forEach=function(t){this.root.forEach(t)},O.prototype.isEmpty=function(){return this.root===Or},O.prototype.has=function(t){return S(this.root,this.sort,t)!==Or},O.prototype.get=function(t,r){var n=S(this.root,this.sort,t);if(n===Or){if(2===arguments.length)return r;throw Error("Key "+t+" not found")}return n.value},O.prototype.set=function(t,r){var n=this.root,e=this.sort,o=z(n,e,t,new x(Or,Or,t,r));return o===n?this:new O(o,e)},O.prototype.remove=function(t){var r=this.root,n=this.sort,e=A(r,n,t);return e===r?this:new O(e,n)},O.prototype.modify=function(t,r){var n=this.root,e=this.sort,o=b(n,e,t,r);return o===n?this:new O(o,e)},O.prototype.merge=function(t){var r=this;return t.forEach(function(t){var n=t[0],e=t[1];r=r.set(n,e)}),r},I.prototype.copy=function(t,r){return new I(t,r,this.key)},I.prototype.modify=function(t){var r=t.key;return this.key===r?this:new I(this.left,this.right,r)},I.prototype.forEach=function(t){this.left.forEach(t),t(this.key),this.right.forEach(t)},J.prototype=Object.create(jr),br.Set=function(t){return N(v(t))},J.prototype[xr]=function(t){if(t.sort===_)return l("Set",t);throw Error("Cannot convert SortedSet to JSON")},J.prototype[_r]=function(t){if(null===t.hash){var r=[];t.forEach(function(t){r.push(i(t))});var n="  ";t.hash=t.sort===_?"(Set"+o(r,n)+")":"(SortedSet "+i(t.sort)+o(r,n)+")"}return t.hash},J.prototype[zr]=s,J.prototype.forEach=function(t){this.root.forEach(t)},J.prototype.isEmpty=function(){return this.root===Or},J.prototype.has=function(t){return S(this.root,this.sort,t)!==Or},J.prototype.add=function(t){var r=this.root,n=this.sort,e=z(r,n,t,new I(Or,Or,t));return e===r?this:new J(e,n)},J.prototype.remove=function(t){var r=this.root,n=this.sort,e=A(r,n,t);return e===r?this:new J(e,n)},J.prototype.union=function(t){var r=this;return t.forEach(function(t){r=r.add(t)}),r},J.prototype.intersect=function(t){var r=this;if(r.root===Or)return r;var n=new J(Or,r.sort);return t.forEach(function(t){r.has(t)&&(n=n.add(t))}),n},J.prototype.disjoint=function(t){var r=this;return t.forEach(function(t){r=r.has(t)?r.remove(t):r.add(t)}),r},J.prototype.subtract=function(t){var r=this;return r.root!==Or&&t.forEach(function(t){r=r.remove(t)}),r},P.prototype.forEach=function(t){for(var r=this;r!==Or;)t(r.car),r=r.cdr},P.prototype.forEachRev=function(t){this.cdr.forEachRev(t),t(this.car)};var Dr=125,Cr=Math.ceil,Rr=Math.floor;X.prototype.copy=function(t,r){return new X(t,r,this.array)},X.prototype.forEach=function(t){this.left.forEach(t),this.array.forEach(function(r){t(r)}),this.right.forEach(t)},er.prototype=Object.create(jr),br.List=function(t){return ir(v(t))},er.prototype[xr]=function(t){return l("List",t)},er.prototype[_r]=function(t){if(null===t.hash){var r=[];t.forEach(function(t){r.push(i(t))}),t.hash="(List"+o(r,"  ")+")"}return t.hash},er.prototype[zr]=s,er.prototype.forEach=function(t){this.root.forEach(t),this.tail.forEachRev(t)},er.prototype.isEmpty=function(){return this.root===Or&&this.tail===Or},er.prototype.size=function(){return this.root.size+this.tail_size},er.prototype.has=function(t){var r=this.size();return 0>t&&(t+=r),Y(t,r)},er.prototype.get=function(t,r){var n=this.size();if(0>t&&(t+=n),Y(t,n)){var e=this.root,o=e.size;return o>t?Z(e,t):W(this.tail,this.tail_size,t-o)}if(2===arguments.length)return r;throw Error("Index "+t+" is not valid")},er.prototype.insert=function(t,r){1===arguments.length&&(r=-1);var n=this.size();0>r&&(r+=n+1);var e=this.root,o=this.tail,i=this.tail_size;if(r===n){if(i===Dr){var u=m(e,new X(Or,Or,V(o,i)));return new er(u,new P(t,Or),1)}return new er(e,new P(t,o),i+1)}if(Y(r,n)){var f=e.size;if(f>r)return new er($(e,r,t),o,i);var h=F(V(o,i),r-f,t),u=m(e,new X(Or,Or,h));return new er(u,Or,0)}throw Error("Index "+r+" is not valid")},er.prototype.remove=function(t){0===arguments.length&&(t=-1);var r=this.size();0>t&&(t+=r);var n=this.root,e=this.tail,o=this.tail_size;if(e!==Or&&t===r-1)return new er(n,e.cdr,o-1);if(Y(t,r)){var i=n.size;if(i>t)return new er(rr(n,t),e,o);var u=q(V(e,o),t-i),f=m(n,new X(Or,Or,u));return new er(f,Or,0)}throw Error("Index "+t+" is not valid")},er.prototype.modify=function(t,r){var n=this.size();if(0>t&&(t+=n),Y(t,n)){var e=this.root,o=this.tail,i=this.tail_size,u=e.size;if(o!==Or&&t===n-1){var f=r(o.car);return f===o.car?this:new er(e,new P(f,o.cdr),i)}if(u>t){var h=tr(e,t,r);return h===e?this:new er(h,o,i)}var s=V(o,i),a=K(s,t-u,r);if(a===s)return this;var h=m(e,new X(Or,Or,a));return new er(h,Or,0)}throw Error("Index "+t+" is not valid")},er.prototype.slice=function(t,r){var n=this.size();if(null==t&&(t=0),null==r&&(r=n),0>t&&(t+=n),0>r&&(r+=n),0===t&&r===n)return this;if(t>r)throw Error("Index "+t+" is greater than index "+r);if(Y(t,n)){if(t===r)return new er(Or,Or,0);if(r>0&&n>=r){var e=this.root,o=e.size,i=[];if(o>=t&&nr(i,e,t,r),r>o){var u=V(this.tail,this.tail_size);G(i,U(u,t-o,r-o))}return new er(T(i),Or,0)}throw Error("Index "+r+" is not valid")}throw Error("Index "+t+" is not valid")},er.prototype.concat=function(t){if(t instanceof er){var r=this.root,n=this.tail,e=t.root,o=t.tail;if(e===Or&&o===Or)return this;if(r===Or&&n===Or)return t;n!==Or&&(r=m(r,new X(Or,Or,V(n,this.tail_size))));var i=d(r,e);return new er(i,o,t.tail_size)}var u=this;return t.forEach(function(t){u=u.insert(t)}),u},ur.prototype=Object.create(jr),br.Queue=function(t){return hr(v(t))},ur.prototype[xr]=function(t){return l("Queue",t)},ur.prototype[zr]=s,ur.prototype.isEmpty=function(){return this.left===Or&&this.right===Or},ur.prototype.forEach=function(t){this.left.forEach(t),this.right.forEachRev(t)},ur.prototype[_r]=function(t){if(null===t.hash){var r=[];t.forEach(function(t){r.push(i(t))}),t.hash="(Queue"+o(r,"  ")+")"}return t.hash},ur.prototype.size=function(){return this.len},ur.prototype.peek=function(t){if(this.isEmpty()){if(1===arguments.length)return t;throw Error("Cannot peek from an empty queue")}return this.left.car},ur.prototype.push=function(t){return this.isEmpty()?new ur(new P(t,this.left),this.right,this.len+1):new ur(this.left,new P(t,this.right),this.len+1)},ur.prototype.pop=function(){if(this.isEmpty())throw Error("Cannot pop from an empty queue");var t=this.left.cdr;if(t===Or){var r=Or;return this.right.forEach(function(t){r=new P(t,r)}),new ur(r,Or,this.len-1)}return new ur(t,this.right,this.len-1)},ur.prototype.concat=function(t){var r=this;return t.forEach(function(t){r=r.push(t)}),r},sr.prototype=Object.create(jr),br.Stack=function(t){return cr(v(t))},sr.prototype[xr]=function(t){return l("Stack",t)},sr.prototype[zr]=s,sr.prototype.isEmpty=function(){return this.root===Or},sr.prototype[_r]=function(t){if(null===t.hash){var r=[];t.forEach(function(t){r.push(i(t))}),t.hash="(Stack"+o(r,"  ")+")"}return t.hash},sr.prototype.forEach=function(t){this.root.forEachRev(t)},sr.prototype.size=function(){return this.len},sr.prototype.peek=function(t){if(this.isEmpty()){if(1===arguments.length)return t;throw Error("Cannot peek from an empty stack")}return this.root.car},sr.prototype.push=function(t){return new sr(new P(t,this.root),this.len+1)},sr.prototype.pop=function(){if(this.isEmpty())throw Error("Cannot pop from an empty stack");return new sr(this.root.cdr,this.len-1)},sr.prototype.concat=function(t){var r=this;return t.forEach(function(t){r=r.push(t)}),r},pr.prototype=Object.create(jr),br.Record=function(t){return yr(y(t))},pr.prototype[xr]=function(t){return p("Record",t)},pr.prototype[zr]=h,pr.prototype[_r]=function(t){return null===t.hash&&(t.hash="(Record"+u(t,"  ")+")"),t.hash},pr.prototype.forEach=function(t){var r=this.keys,n=this.values;for(var e in r){var o=r[e];t([e,n[o]])}},pr.prototype.get=function(t){if("string"!=typeof t)throw Error("Expected string key but got "+t);var r=this.keys[t];if(null==r)throw Error("Key "+t+" not found");return this.values[r]},pr.prototype.set=function(t,r){return this.modify(t,function(){return r})},pr.prototype.modify=function(t,r){if("string"!=typeof t)throw Error("Expected string key but got "+t);var n=this.keys,e=n[t];if(null==e)throw Error("Key "+t+" not found");var o=this.values,i=K(o,e,r);return i===o?this:new pr(n,i)},pr.prototype.update=function(t){var r=this;return t.forEach(function(t){var n=t[0],e=t[1];r=r.set(n,e)}),r};var Ir=0;vr.prototype=Object.create(jr),vr.prototype[_r]=function(t){return"(Ref "+i(t._id)+")"},vr.prototype.get=function(){return this._value},vr.prototype.set=function(t){var r=this._value;t!==r&&(this._value=t,null!=this._onchange&&this._onchange(r,t))},vr.prototype.modify=function(t){this.set(t(this.get()))},function(t,r){"function"==typeof define&&define.amd?define(["exports"],r):"object"==typeof exports?r(exports):(t.Immutable={},r(t.Immutable))}(this,function(t){t.equal=wr,t.fromJS=kr,t.toJS=f,t.isDict=j,t.isSet=B,t.isSortedDict=D,t.isSortedSet=L,t.isList=or,t.isQueue=fr,t.isStack=ar,t.isImmutable=mr,t.SortedDict=C,t.SortedSet=M,t.Dict=R,t.Set=N,t.List=ir,t.Queue=hr,t.Stack=cr,t.simpleSort=k,t.defaultSort=_,t.isRecord=lr,t.Record=yr,t.toJSON=c,t.fromJSON=a,t.deref=gr,t.Ref=dr,t.isRef=Er})}).call(this);